Implementation of H-ESP/ESP alghorithm
